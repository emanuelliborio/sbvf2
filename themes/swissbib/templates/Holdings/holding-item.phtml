<?php

$isAvailable= isset($item['isAvailable']) && $item['isAvailable'];
$actions	= array();
$desc		= '';

if (isset($item['backlink'])) {
	$actions[] = array(
		'label'	=> 'zum Bestand',
		'action'=> $item['backlink'],
		'escape'=> false
	);
}
if (isset($item['eodlink']) && $item['eodlink']) {
	$actions[] = array(
		'label'	=> 'eBooks on Demand',
		'action'=> $item['eodlink'],
		'escape'=> false
	);
}

	// Build item links
	// @todo Move into holdings helper or view helper as soon as the feature set is clear
if( isset($item['userActions']) ) {
	if( $item['userActions']['hold'] ) {
		$actions[] = array(
			'label'	=> 'ausleihen',
			'action'=> $this->recordLink()->getHoldUrl($item['holdLink']),
			'escape'=> false
		);
	}
	if( $item['userActions']['shortLoan'] ) {
		$actions[] = array(
			'label'	=> 'Kurzausleihe',
			'action'=> 'javascript:alert(\'Not implemented yet\')'
		);
	}
	if( $item['userActions']['photocopyRequest'] ) {
		$actions[] = array(
			'label'	=> 'Kopie bestellen',
			'action'=> $item['userActions']['photocopyRequestLink']
		);
	}
	if( $item['userActions']['bookingRequest'] ) {
		$actions[] = array(
			'label'	=> 'Booking Request',
			'action'=> 'javascript:alert(\'Not implemented yet\')'
		);
	}
} elseif( isset($item['holdLink']) ) {
	$actions[] = array(
		'label'	=> 'ausleihen',
		'action'=> $this->recordLink()->getHoldUrl($item['holdLink']),
		'escape'=> false
	);
}

	// Temporary usage for error info
if (isset($item['error'])) {
	$desc = $item['error'];
}

$availability = isset($item['availability']['loan-status']) ? $item['availability']['loan-status'] : '';

?>
<tr>
    <td>
        <ul>
            <?php foreach($actions as $action): ?>
            <?php $href = !isset($action['escape']) || $action['escape'] ? $this->escapeHtml($action['action']) : $action['action']; ?>
            <li><a href="<?=$href?>" ><?=$this->escapeHtml($action['label'])?></a></li>
            <?php endforeach; ?>
        </ul>
    </td>
    <td><?=$this->escapeHtml($availability)?></td>
	<td><?=$this->escapeHtml($item['location_expanded'])?></td>
	<td><?=$this->escapeHtml($item['signature'])?></td>
    <td><?=$this->escapeHtml($item['opac_note'])?></td>
	<td><?=$this->escapeHtml($desc)?></td>
</tr>