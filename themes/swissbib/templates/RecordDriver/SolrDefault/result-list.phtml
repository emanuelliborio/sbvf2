<?php
	/** @var	Swissbib\RecordDriver\SolrMarc	$resultItem  */
	/** @var	VuFind\View\Helper\Root\Record		$viewRecord  */
$resultItem		   = $this->driver;
$viewRecord		   = $this->record($this->driver);
$thumbnail		   = $viewRecord->getThumbnail('small');
$thumbnailSrc      = $thumbnail ? $thumbnail : $this->url('cover-unavailable');
$detailLink		   = $this->recordLink()->getUrl($resultItem);
$title			   = $this->mainTitle($resultItem->getShortTitle());
$titleStatement	   = $resultItem->getTitleStatement(true);
$responsible       = isset($titleStatement['statement_responsibility']) ? $titleStatement['statement_responsibility'] : $resultItem->getPrimaryAuthor(true);
$responsible       = isset($responsible) && !empty($responsible) ? $responsible : implode('; ', $resultItem->getSecondaryAuthors(true));
$edition		   = $resultItem->getEdition();
$publicationDate   = $this->publicationDateMarc($resultItem->getPublicationDates());
$hostitems         = $resultItem->getHostItemEntry();
$groupID		   = $resultItem->getGroup(true);
$uniqueID          = $resultItem->getUniqueID();
$showFRBR          = $this->configAccess()->Site->displayFrbr;
$memorizeLink	   = $this->recordLink()->getActionUrl($this->driver, 'Save');

?>
<tr>
    <!-- Column 1: Index -->
	<td class="col-1 small center nodivider"><?=$this->recordIndex?></td>
    <!-- Column 2: Memo list -->
	<td class="col-2 nodivider">
		<a href="<?=$memorizeLink?>" class="icon_notepad_add" title="<?=$this->transEsc('memorizelistadd')?>"></a>
	</td>
    <!-- Column 3: Teaser-image / Thumbnail -->
	<td class="col-3 right nodivider">
		<a class="preview" href="<?=$detailLink?>" title="<?=$this->escapeHtml($title)?>">
            <? /** ---------------------------------------------------- */ ?>
            <? /** temporary fix params over here, @todo: fix in driver */ ?>
            <? if(is_array($title)) $title = implode(' ', $title); ?>
            <? /** ---------------------------------------------------- */ ?>
			<img src="<?=$thumbnailSrc?>" alt="<?=$this->escapeHtml($title)?>" class="dropshadow"/>
		</a>
	</td>
    <!-- Column 4: Title and author details => links to full-view -->
	<td class="col-4">
		<h3>
            <a href="<?=$detailLink?>" title="<?=$this->escapeHtml($title)?>" class="color singleLink"><?=$this->escapeHtml($title)?></a>
        </h3>

        <!-- Untertitel und Verfasserangabe -->
        <div class="meta">
            <?php if (isset($titleStatement['title_remainder']) || isset($titleStatement['statement_responsibility'])): ?>
				<?php if (isset($titleStatement['title_remainder'])): ?>
					<span>
						<?=$this->escapeHtml($titleStatement['title_remainder'])?>
					</span><br />
				<?php endif; ?>
			<?php endif; ?>

            <?php if ($responsible): ?>
			    <h6><?=$this->transEsc('Author')?>:</h6>
			        <span>
    					<?=$this->escapeHtml($responsible)?>
                    </span><br />
            <?php endif; ?>
        </div>

        <!-- Host Item & Jahr -->
        <div class="meta">
            <? if ($hostitems): ?>
                <? foreach ($hostitems as $hostitem): ?>
                <h6><?=$this->transEsc('note_773')?>: </h6>
                <? $text = array_key_exists('related', $hostitem) ? $hostitem['title'] . ', ' . $hostitem['related'] : $hostitem['title'] ?>
                <span><?=$this->escapeHtml($text)?></span><br />
                <? endforeach; ?>
            <? endif; ?>
			<h6><?=$this->transEsc('Year')?>:</h6>
            <span><?=$this->escapeHtml($publicationDate)?></span>
            <?php if ($edition): ?>
                <h6><?=$this->transEsc('Edition')?>:</h6>
                <span><?=$this->escapeHtml($edition)?></span>
            <?php endif; ?>
		</div>

        <!-- format -->
		<div class="format">
			<?=$viewRecord->getFormatList()?>

        <!-- <h6 class="icon_format_book">Buch</h6> -->
            <?php if (!empty($showFRBR) && $showFRBR && !empty($groupID) && !strcmp($results->getParams()->getSearchHandler(),'FRBR') == 0   ) : ?>


                <a href="<?= $this->url('search-results') . '?lookfor=' . $groupID . "&type=FRBR&limit=" . $results->getParams()->getLimit()  ?>" class="linkbutton icon_show" title="<?=$this->transEsc('FRBR_Button')?>">
					<span><?=$this->transEsc('FRBR_Button')?></span>
				</a>
            <?php endif; ?>
		</div>
		<span class="Z3988" title="<?=$this->escapeHtml($this->driver->getOpenURL())?>"></span>

		<?php if (!empty($uniqueID)): ?>
			<div class="print">
				<h6><?=$this->transEsc('Item_ID')?>:</h6> <span><?=$uniqueID ?> </span>
			</div>
		<?php endif; ?>

	</td>

    <!-- Column 5 & 6 : libraries, links, info -->
	<td class="col-5 small right nodivider colholdingscounter">
		<?=$this->render('search/results/available.phtml')?>
	</td>
	<td class="col-6 right">
		<?=$this->render('search/results/libraries.phtml')?>
		<?php if ($this->isFavoriteInstitution($resultItem->getInstitutions())): ?>
			<img src="<?= $this->basePath('themes/swissbib/images/icon_favorit_library.gif') ?>" alt="Favourite library icon (heart)" class="favourite-library">
		<?php endif; ?>
	</td>
</tr>