<?php
// Set page title.
$this->headTitle($this->translate('Description') . ': ' . $this->driver->getBreadcrumb());

// Grab clean ISBN for convenience:
//$isbn = $this->driver->getCleanISBN();

// Activate Syndetics Plus if necessary:
//if ($this->syndeticsPlus()->isActive()) {
//    $this->headScript()->appendFile($this->syndeticsPlus()->getScript());
//}

$resultItem	= $this->driver;
$subjectVocabularies	= $resultItem->getAllSubjectVocabularies();
$subjects = $this->driver->getAllSubjectHeadings();
?>


<!-- Tab-Inhalte gemaess TP detailstab -->

<?/* Display Standard-IDs */?>
<? $isbns = $this->driver->getISBNs(); ?>
<? $issns = $this->driver->getISSNs(); ?>
<? $ismns = $this->driver->getISMNs(); ?>
<? $dois  = $this->driver->getDOIs(); ?>
<? $urns  = $this->driver->getURNs(); ?>
<? if (!empty($isbns) or !empty($issns) or !empty($ismns) or !empty($dois) or !empty($urns)): ?>
<? $contentDisplayed = true; ?>
    <div class="details">
        <? if (!empty($isbns)): ?>
            <h4><?=$this->transEsc('ISBN')?>: </h4>
            <p>
                <? foreach ($isbns as $field): ?>
                <?=$this->escapeHtml($field)?><br />
                <? endforeach; ?>
            </p>
        <? endif; ?>
        <? if (!empty($issns)): ?>
            <h4><?=$this->transEsc('ISSN')?>: </h4>
            <p>
                <? foreach ($issns as $field): ?>
                <?=$this->escapeHtml($field)?><br />
                <? endforeach; ?>
            </p>
        <? endif; ?>
        <? if (!empty($ismns)): ?>
            <h4><?=$this->transEsc('ISMN')?>: </h4>
            <p>
                <? foreach ($ismns as $field): ?>
                <?=$this->escapeHtml($field)?><br />
                <? endforeach; ?>
            </p>
        <? endif; ?>
        <? if (!empty($dois)): ?>
            <h4><?=$this->transEsc('DOI')?>: </h4>
            <p>
                <? foreach ($dois as $field): ?>
                <?=$this->escapeHtml($field)?><br />
                <? endforeach; ?>
            </p>
        <? endif; ?>
        <? if (!empty($urns)): ?>
            <h4><?=$this->transEsc('URN')?>: </h4>
            <p>
                <? foreach ($urns as $field): ?>
                <?=$this->escapeHtml($field)?><br />
                <? endforeach; ?>
            </p>
        <? endif; ?>
    </div>
<? endif; ?>

<?/* Display alternative title */?>
<? $alttitle = $this->driver->getAltTitle(); if (!empty($alttitle)): ?>
    <div class="details">
        <h4><?=$this->transEsc('Other_Title')?></h4>
        <p>
            <? foreach ($alttitle as $field): ?>
            <?=$this->escapeHtml($field)?><br />
            <? endforeach; ?>
        </p>
    </div>
<? endif; ?>

<?/* Display series section if at least one series exists. */?>
<? $series = $this->driver->getSeries(); if (!empty($series)): ?>
    <div class="details">
        <h4><?=$this->transEsc('Series')?>: </h4>
        <? foreach ($series as $field): ?>
        <? if (is_array($field)): ?>
            <? if (!empty($field['name'])): ?>
                <p><?=$this->escapeHtml($field['name'])?>
                    <? if (!empty($field['number'])): ?>
                        <?=$this->escapeHtml($field['number'])?>
                    <? endif; ?>
                    <br />
                </p>
            <? endif; ?>
            <? else: ?>
            <p>
                <?=$this->escapeHtml($field)?> <br />
            </p>
        <? endif; ?>
        <? endforeach; ?>
    </div>
<? endif; ?>

<?/* Display and link to related items (field configured in config_base.ini -> marc_links) */?>
<? $recordLinks = $this->driver->getAllRecordLinks(); if (!empty($recordLinks)): ?>
    <? $contentDisplayed = true; ?>
        <div class="details">
        <h4><?=$this->transEsc('Related Items')?></h4>
        <p>
            <? foreach ($recordLinks as $recordLink): ?>
            <?=$this->transEsc($recordLink['title'])?>:
            <a href="<?=$this->recordLink()->related($recordLink['link'])?>"><?=$this->escapeHtml($recordLink['value'])?></a><br />
            <? endforeach; ?>
        </p>
    </div>
<? endif; ?>

<?/* This section is only valid when the above links do not exist */?>
<? $nextTitles = $this->driver->getNewerTitles(); $prevTitles = $this->driver->getPreviousTitles(); ?>
<? if (!empty($nextTitles) or !empty($prevTitles)): ?>
    <div class="details">
        <? if (!empty($nextTitles)): ?>
        <h4><?=$this->transEsc('New Title')?>: </h4>
        <p>
            <? foreach($nextTitles as $field): ?>
            <a href="<?=$this->record($this->driver)->getLink('title', $field)?>"><?=$this->escapeHtml($field)?></a><br/>
            <? endforeach; ?>
        </p>
        <? endif; ?>
        <? if (!empty($prevTitles)): ?>
        <h4><?=$this->transEsc('Previous Title')?>: </h4>
        <p>
            <? foreach($prevTitles as $field): ?>
            <a href="<?=$this->record($this->driver)->getLink('title', $field)?>"><?=$this->escapeHtml($field)?></a><br/>
            <? endforeach; ?>
        </p>
        <? endif; ?>
    </div>
<? endif; ?>

<?/* div-box for all notes */ ?>

<? $notes = $this->driver->getGeneralNotes() ?>
<? $diss = $this->driver->getDissertationNotes() ?>
<? $bib = $this->driver->getBibliographyNotes() ?>
<? $access = $this->driver->getAccessRestrictions() ?>
<? $credits = $this->driver->getProductionCredits() ?>
<? $awards = $this->driver->getAwards() ?>
<? if (!empty($notes) or !empty($diss) or !empty($bib) or !empty($access) or !empty($credits) or !empty($awards)): ?>
<? $contentDisplayed = true; ?>
<div class="details">
    <?/* Display general notes (field 500) */?>
    <? if (!empty($notes)): ?>
    <h4><?=$this->transEsc('Item Description')?>: </h4>
    <p>
        <? foreach ($notes as $field): ?>
        <?=$this->escapeHtml($field)?><br />
        <? endforeach; ?>
    </p>
    <? endif; ?>
    <?/* Display dissertation notes (field 502) */?>
    <? if (!empty($diss)): ?>
        <h4><?=$this->transEsc('Dissertation_Note')?>: </h4>
        <p>
            <? foreach ($diss as $field): ?>
            <?=$this->escapeHtml($field)?><br />
            <? endforeach; ?>
        </p>
    <? endif; ?>
    <?/* Display bibliography notes (field 504) */?>
    <? if (!empty($bib)): ?>
        <h4><?=$this->transEsc('Bibliography')?>: </h4>
        <p>
            <? foreach ($bib as $field): ?>
            <?=$this->escapeHtml($field)?><br />
            <? endforeach; ?>
        </p>
    <? endif; ?>
    <?/* Display access restriction notes (field 506) */?>
    <? if (!empty($access)): ?>
        <h4><?=$this->transEsc('Access')?>: </h4>
        <p>
            <? foreach ($access as $field): ?>
            <?=$this->escapeHtml($field)?><br />
            <? endforeach; ?>
        </p>
    <? endif; ?>
    <?/* Display production credit notes (field 508) */?>
    <? if (!empty($credits)): ?>
        <h4><?=$this->transEsc('Production Credits')?>: </h4>
        <p>
            <? foreach ($credits as $field): ?>
            <?=$this->escapeHtml($field)?><br />
            <? endforeach; ?>
        </p>
    <? endif; ?>
    <?/* Display citation / reference note (field 510) */?>
    <?/* Display copy and version identification note (fields 562 or 590) */?>
    <?/* Display award notes (field 586) */?>
    <? if (!empty($awards)): ?>
        <h4><?=$this->transEsc('Awards')?>: </h4>
        <p>
            <? foreach ($awards as $field): ?>
            <?=$this->escapeHtml($field)?><br />
            <? endforeach; ?>
        </p>
    <? endif; ?>
</div>
<?php endif; ?>

<?php if(sizeof($subjectVocabularies)): ?>
    <?=$this->subjectVocabularies($subjectVocabularies)?>
<?php endif; ?>

<?/* subject display based on VuFind standard mechanism */?>
<? $subjects = $this->driver->getAllSubjectHeadings(); if (!empty($subjects)): ?>
<h4><?=$this->transEsc('Subjects')?>: </h4>
<? foreach ($subjects as $field): ?>
    <? $subject = ''; ?>
    <p>
    <? $i = 0; foreach ($field as $subfield): ?>
            <?=($i++ == 0) ? '' : ' &gt; '?>
        <? $subject = trim($subject . ' ' . $subfield); ?>
        <?=$this->escapeHtml($subfield)?>
        <? endforeach; ?>
    </p>
    <? endforeach; ?>

<? endif; ?>